stages:
  - build
#  - test
  - deploy


build:
  stage: build
  tags:
    - shell
    - ql-dev
  artifacts:
    paths:
      - out
  script: 
    - dotnet publish -c Release -o out QuartierLatin.Admin

#tests:
#  stage: test
#  script: 
#    - dotnet run -c Release QuartierLatin.Admin.Tests

deploy:
  stage: deploy
  tags:
    - shell
    - ql-dev
  dependencies:
    - build
  only: 
    - master
  script: 
    - sudo systemctl stop quartier-admin
    - rm -rf /apps/quartier-admin/app/ && cp -r out/ /apps/quartier-admin/app/
    - sudo systemctl start quartier-admin
